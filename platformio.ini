[platformio]
; –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º - –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—à–∏–≤–∫–∏ —á–µ—Ä–µ–∑ ISP
default_envs = isp_upload_16mhz

;===============================================================
; A. –ó–ê–ì–ê–õ–¨–ù–Ü –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø (—Ç—ñ–ª—å–∫–∏ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä)
;===============================================================
[common_settings]
platform = atmelavr
framework = arduino
board = ATmega8
board_build.lto = yes
board_bod.type = 2.7v
board_eeprom.type = retain
board_avrdude.conf_path = ${platformio.packages_dir}/framework-arduino-avr-minicore/avrdude.conf

;===============================================================
; B. –°–ï–†–ï–î–û–í–ò–©–ê –î–õ–Ø –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –ö–û–î–£ (Upload via Bootloader)
; (!!! –ù–ï –ü–†–ê–¶–Æ–Æ–¢–¨: –ö–û–î –ó–ê–í–ï–õ–ò–ö–ò–ô !!!)
;===============================================================
[common_bootloader_upload]
extends = common_settings
upload_protocol = arduino
upload_port = /dev/cu.usbserial-1440
upload_speed = 19200
upload_command = avrdude -v -C ${common_settings.board_avrdude.conf_path} -p $BOARD_MCU -c $UPLOAD_PROTOCOL -P $UPLOAD_PORT -b $UPLOAD_SPEED -B 10 -U flash:w:$SOURCE
; –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è bootloader'a –¥–ª—è MiniCore
board_bootloader.type = uart0
board_bootloader.size = 512

[env:upload_16mhz]
extends = common_bootloader_upload
board_build.f_cpu = 16000000L

[env:upload_8mhz]
extends = common_bootloader_upload
board_build.f_cpu = 8000000L


;===============================================================
; C. –ó–ê–ì–ê–õ–¨–ù–Ü –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –î–õ–Ø ISP
;===============================================================
[common_isp]
extends = common_settings
; –í–∫–∞–∑—É—î–º–æ, —â–æ bootloader'a –ù–ï–ú–ê–Ñ (–¥–∞—î 8KB)
board_bootloader.type = no_bootloader
; --- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è "Arduino as ISP" ---
upload_protocol = stk500v1
upload_port = /dev/cu.usbserial-1440
upload_speed = 19200
; –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –±–µ–∑–ø–µ—á–Ω—É —à–≤–∏–¥–∫—ñ—Å—Ç—å bit clock (–∑–∞–º—ñ—Å—Ç—å 64)
upload_flags = -B 10


;===============================================================
; D. –°–ï–†–ï–î–û–í–ò–©–ê –î–õ–Ø –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –ü–†–û–®–ò–í–ö–ò (via ISP)
; (–¶–µ –≤–∞—à –Ω–æ–≤–∏–π —Ä–æ–±–æ—á–∏–π –º–µ—Ç–æ–¥)
;===============================================================
[env:isp_upload_16mhz]
extends = common_isp
board_build.f_cpu = 16000000L
; –¶—è –∫–æ–º–∞–Ω–¥–∞ –ó–ê–í–ê–ù–¢–ê–ñ–£–Ñ –ü–†–û–®–ò–í–ö–£ (HEX)
upload_command = avrdude -v -C ${common_settings.board_avrdude.conf_path} -p $BOARD_MCU -c $UPLOAD_PROTOCOL -P $UPLOAD_PORT -b $UPLOAD_SPEED ${upload_flags} -U flash:w:$SOURCE

[env:isp_upload_8mhz]
extends = common_isp
board_build.f_cpu = 8000000L
; –¶—è –∫–æ–º–∞–Ω–¥–∞ –ó–ê–í–ê–ù–¢–ê–ñ–£–Ñ –ü–†–û–®–ò–í–ö–£ (HEX)
upload_command = avrdude -v -C ${common_settings.board_avrdude.conf_path} -p $BOARD_MCU -c $UPLOAD_PROTOCOL -P $UPLOAD_PORT -b $UPLOAD_SPEED ${upload_flags} -U flash:w:$SOURCE


;===============================================================
; E. –°–ï–†–ï–î–û–í–ò–©–ê –î–õ–Ø –ü–†–û–®–ò–í–ö–ò FUSES (via ISP)
; (–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ '... --target upload' –¥–ª—è –∑–∞–ø—É—Å–∫—É)
;===============================================================
[env:set_fuses_16mhz]
extends = common_isp
board_build.f_cpu = 16000000L
board_fuses.lfuse = 0xFF
; hfuse 0xDD = –ë–ï–ó Bootloader'a (—Å—Ç–∞—Ä—Ç –∑ 0x0000), SPIEN, Brown-out 2.7V
board_fuses.hfuse = 0xDD

; üîΩüîΩüîΩ (v2.6.7) –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –°–ò–ù–¢–ê–ö–°–ò–°–£ (–ñ–æ—Ä—Å—Ç–∫–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è) üîΩüîΩüîΩ
; –ñ–æ—Ä—Å—Ç–∫–æ –≤–∫–∞–∑—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥—É
upload_command = avrdude -v -C ${common_settings.board_avrdude.conf_path} -p $BOARD_MCU -c $UPLOAD_PROTOCOL -P $UPLOAD_PORT -b $UPLOAD_SPEED ${upload_flags} -U lfuse:w:0xFF:m -U hfuse:w:0xDD:m

[env:set_fuses_8mhz]
extends = common_isp
board_build.f_cpu = 8000000L
board_fuses.lfuse = 0xE4
board_fuses.hfuse = 0xDD

; üîΩüîΩüîΩ (v2.6.7) –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –°–ò–ù–¢–ê–ö–°–ò–°–£ (–ñ–æ—Ä—Å—Ç–∫–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è) üîΩüîΩüîΩ
; –ñ–æ—Ä—Å—Ç–∫–æ –≤–∫–∞–∑—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥—É
upload_command = avrdude -v -C ${common_settings.board_avrdude.conf_path} -p $BOARD_MCU -c $UPLOAD_PROTOCOL -P $UPLOAD_PORT -b $UPLOAD_SPEED ${upload_flags} -U lfuse:w:0xE4:m -U hfuse:w:0xDD:m